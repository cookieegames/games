<html lang="en-us">
<head>
    <meta http-equiv="Content-Security-Policy" content="child-src 'self' *.allwebgames.com *.api.gameanalytics.com *.gametok.com *.juegocasa.com *.playhop.com *.wowspiele.de *.yandex.*; connect-src 'self' *.allwebgames.com *.api.gameanalytics.com *.eponesh.com *.gameanalytics.com *.gametok.com *.juegocasa.com *.playhop.com *.unity3d.com *.website.yandexcloud.net *.wowspiele.de *.yandex.*; default-src 'self' *.api.gameanalytics.com; font-src 'self' *.allwebgames.com *.api.gameanalytics.com *.gametok.com *.juegocasa.com *.playhop.com *.website.yandexcloud.net *.wowspiele.de *.yandex.*; frame-src 'self' *.allwebgames.com *.api.gameanalytics.com *.gametok.com *.juegocasa.com *.playhop.com *.website.yandexcloud.net *.wowspiele.de *.yandex.*; img-src 'self' *.allwebgames.com *.api.gameanalytics.com *.eponesh.com *.gametok.com *.juegocasa.com *.playhop.com *.website.yandexcloud.net *.wowspiele.de *.yandex.*; media-src 'self' *.allwebgames.com *.api.gameanalytics.com *.gametok.com *.juegocasa.com *.playhop.com *.website.yandexcloud.net *.wowspiele.de *.yandex.*; object-src 'self' *.allwebgames.com *.api.gameanalytics.com *.gametok.com *.juegocasa.com *.playhop.com *.wowspiele.de *.yandex.*; script-src 'self' 'unsafe-eval' 'unsafe-inline' *.allwebgames.com *.api.gameanalytics.com *.eponesh.com *.gameanalytics.com *.gametok.com *.juegocasa.com *.playhop.com *.website.yandexcloud.net *.wowspiele.de *.yandex.*; style-src 'self' 'unsafe-eval' 'unsafe-inline' *.allwebgames.com *.api.gameanalytics.com *.gametok.com *.juegocasa.com *.playhop.com *.website.yandexcloud.net *.wowspiele.de *.yandex.*; worker-src 'self' *.allwebgames.com *.gametok.com *.juegocasa.com *.playhop.com *.website.yandexcloud.net *.wowspiele.de *.yandex.*">
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Car Crash Simulator | Cookie Edition</title>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            padding: 0px;
            margin: 0px;
        }
        .fullscreen {
            background: #383838;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0px;
            left: 0px;
        }
        #banner-container {
            position: absolute;
            bottom: 0px;
            width: 100%;
            height: 90px;
        }
        #loading-overlay {
            font-size: 20px;
            z-index: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #icon {
            max-width: 120px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        #progress-bar {
            border-radius: 5px;
            width: 90%;
            max-width: 250px;
            height: 20px;
            background: #242424;
            padding: 5px;
        }
        #progress-bar-fill {
            border-radius: 3px;
            width: 0%;
            height: 100%;
            background: #FF9A00;
        }
    </style>
</head>
<body>
    <canvas id="canvas" class="fullscreen" width="456" height="681" style="cursor: default;"></canvas>
    <div id="banner-container" style="display: none"></div>
    <div id="loading-overlay" style="display: flex;">
        <img id="icon" src="loading_icon.png" alt="Loading...">
        <div id="progress-bar">
            <div id="progress-bar-fill"></div>
        </div>
    </div>

    <script src="./instant-games-bridge.js"></script>
    <script>
        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            let meta = document.createElement('meta');
            meta.name = 'viewport';
            meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
            document.getElementsByTagName('head')[0].appendChild(meta);
        }

        let canvas = document.getElementById('canvas');
        let loadingOverlay = document.getElementById('loading-overlay');
        let progressBarFill = document.getElementById('progress-bar-fill');
        let bannerContainer = document.getElementById('banner-container');

        const STORAGE_DATA_SEPARATOR = '{bridge_data_separator}';
        const STORAGE_KEYS_SEPARATOR = '{bridge_keys_separator}';
        const STORAGE_VALUES_SEPARATOR = '{bridge_values_separator}';

        window.unityInstance = null;
        let progressBarFillingInterval = null;

        function sendMessageToUnity(name, value) {
            if (window.unityInstance !== null) {
                window.unityInstance.SendMessage('Bridge', name, value);
            }
        }

        function onUnityLoadingProgressChanged(progress) {
            if (progress === 0.9) {
                completeProgressBarFilling();
                return;
            }

            progressBarFill.style.width = `${progress * 100}%`;
            if (progress === 1 && progressBarFillingInterval !== null) {
                clearInterval(progressBarFillingInterval);
                progressBarFillingInterval = null;
            }
        }

        function completeProgressBarFilling() {
            if (progressBarFillingInterval !== null) {
                return;
            }

            let currentPercent = 90;
            progressBarFill.style.width = `${currentPercent}%`;
            progressBarFillingInterval = setInterval(() => {
                currentPercent++;
                if (currentPercent > 100) {
                    currentPercent = 100;
                }

                progressBarFill.style.width = `${currentPercent}%`;

                if (currentPercent >= 100) {
                    clearInterval(progressBarFillingInterval);
                    progressBarFillingInterval = null;
                    return;
                }
            }, 100);
        }

        window.addEventListener('pointerdown', () => {
            window.focus();
            canvas.focus();
        });

        let bridgeOptions = {
            platforms: {}
        };

        // initialization
        bridge.initialize(bridgeOptions)
            .then(() => {
                bridge.advertisement.on('banner_state_changed', state => sendMessageToUnity('OnBannerStateChanged', state));
                bridge.advertisement.on('interstitial_state_changed', state => sendMessageToUnity('OnInterstitialStateChanged', state));
                bridge.advertisement.on('rewarded_state_changed', state => sendMessageToUnity('OnRewardedStateChanged', state));
                bridge.game.on('visibility_state_changed', state => sendMessageToUnity('OnVisibilityStateChanged', state));

                if (bridge.platform.id === bridge.PLATFORM_ID.YANDEX || bridge.platform.id === bridge.PLATFORM_ID.GAME_DISTRIBUTION) {
                    bridge.advertisement.showInterstitial();
                }

                let unityLoader = document.createElement('script');
                unityLoader.src = 'Build/Build_Web.loader.js';
                unityLoader.onload = () => {
                    createUnityInstance(canvas, {
                        dataUrl: 'https://small.fileditchstuff.me/s18/JJiYXxiZLKytfDJgzIsw.br',
                        frameworkUrl: 'Build/Build_Web.framework.js.br',
                        codeUrl: 'https://small.fileditchstuff.me/s18/bJzqsCPZqvxamsxeuCY.br',
                        streamingAssetsUrl: 'StreamingAssets',
                        companyName: 'DefaultCompany',
                        productName: 'Car Crash Simulator',
                        productVersion: '18',
                    }, onUnityLoadingProgressChanged)
                    .then((unityInstance) => {
                        window.unityInstance = unityInstance;
                        loadingOverlay.remove();
                        canvas.focus();
                    })
                    .catch((error) => {
                        console.error(error);
                    });
                };
                document.body.appendChild(unityLoader);
            })
            .catch(error => console.error(error));

        // platform and other functions here...

    </script>
</body>
</html>
